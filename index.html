<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>

</head>

<body>
  <textarea style="width: 300px; height: 300px;">import {
        LitElement,
        html,
        css
      } from './lit-core.min.js';
      export class CustomDatePicker extends LitElement {
        static properties = {
          data: {},
          _weeks: {},
      _date:{}
        };
        static styles = css`:host {
        color: #0f0f0f;
        -webkit-text-size-adjust: 100%;
        font-size: 12px;
        z-index: 1002;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      
      .dialog {
        position: relative;
        z-index: 1002;
        max-height: 180px;
        overflow-y: auto;
        color: #0f0f0f;
        width: 90vw;
        border-radius: 8px;
        background-color: #fff;
        overflow-y: auto;
      
      }
      
      .dialog::-webkit-scrollbar {
        display: none;
      }
      
      .overlay {
        font-family: Roboto, Arial, sans-serif;
        word-wrap: break-word;
        color: #0f0f0f;
        -webkit-text-size-adjust: 100%;
        font-size: 1.2rem;
        position: fixed;
        top: 0;
        bottom: 0;
        left: 0;
        right: 0;
        z-index: 1001;
        cursor: pointer;
        background-color: rgba(0, 0, 0, 0.3);
      }`;
        constructor() {
          super();
          this.data = [];
          this._weeks = ['日', '一', '二', '三', '四', '五', '六'];
      const now=new Date();
      this._date=`${now.getFullYear()}年`
        }
        navigate(evt) {
          const index = evt.currentTarget.dataset.index;
          this.dispatchEvent(new CustomEvent('submit', {
            detail: index
          }));
        }
        render() {
          return html`<div class="dialog">
      
      <div style="
      display: grid;
      grid-template-columns: repeat(7,1fr);
      gap: 1px;
      padding: 16px;
      ">
       <div style="grid-column:  1 / 3;">
      </div>
      <div class="" style="
      font-size: 20px;
      line-height: 24px;
      font-weight: 500;
      margin:  0px 0px 16px 0px;
      color: rgb(32, 33, 36);
      grid-column:  3 / 6;
      text-align:center;
      ">
      2022年12月
      </div>
      <div style="grid-column:  6 / 8;">
      </div>
      ${this._weeks .map((element,index)=>{
      return html`<div style="font-size: 14px;line-height: 20px;text-align:center;color: #333;color: rgb(95, 99, 104);" data-index="${index}">${element}</div>`;
      })}
      </div>
      ${this.data .map((element,index)=>{
      return html`<div class="item" data-index="${index}" @click="${this.navigate}">${element}</div>`;
      })}
        </div>
      <div class="overlay" @click="${this.close}">
        </div>`;
        }
        connectedCallback() {
          super.connectedCallback();
        }
      }
      customElements.define('custom-date-picker', CustomDatePicker);
      /*
      <!--
      <script type="module" src="../components/custom-date-picker.js"></script>
      <custom-date-picker bind @submit=""></custom-date-picker>
                                               -->
                                           */</textarea>
  <script>
    function getLine() {
      let start = textarea.selectionStart;
      const strings = textarea.value;

      if (strings[start] === '\n' && start - 1 > 0) {
        start--;
      }
      while (start > 0 && strings[start] != '\n') {
        start--;
      }
      let end = textarea.selectionEnd;
      while (end - 1 < strings.length && strings[end] != '\n') {
        end++;
      }
      return strings.substring(start, end);
    }
    const textarea = document.querySelector('textarea');
    document.addEventListener('keydown', evt => {
      if (evt.key === 'F1') {
        evt.preventDefault();
        const reg = /(?<=css`)[^`]+(?=`)/;
        const match = reg.exec(textarea.value);
        let str = match[0].replaceAll(/[\r\n]+/g, '');
        str = str.replaceAll(/((?<=[;{}:,])\s+)|(\s+(?=[{]))/g, '');
        textarea.value = textarea.value.replace(match[0], str);
      }
    })


    /*
    let start = textarea.selectionStart;
            let end = textarea.selectionEnd;
            while (start > 0) {
                if (/\s/.test(textarea.value[start])) {
                    let j = 0;
                    while (start > 0 && /\s/.test(textarea.value[start])) {
                        if (textarea.value[start] === '\n') {
                            j++;
                        }
                        start--;
                    }
                    if (j > 2) {
                        break;
                    }
                }
                start--;
            }
            start++;
            while (end < textarea.value.length) {
                if (/\s/.test(textarea.value[end])) {
                    let j = 0;
                    while (end < textarea.value.length > 0 && /\s/.test(textarea.value[end])) {
                        if (textarea.value[end] === '\n') {
                            j++;
                        }
                        end++;
                    }
                    if (j > 2) {
                        break;
                    }
                }
                end++;
            }
            console.log(start,end, textarea.value.substring(start,end))
    */

    const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg')
  </script>
  <script>
      (() => {
        function getDatePart() {
          const d = new Date();
          const seconds = d.getTime() / 1000 | 0;
          hoursInSeconds = (seconds - d.getTimezoneOffset() * 60) % (3600 * 24);
          console.log(seconds - hoursInSeconds);
        }
        getDatePart();

      })()
  </script>
</body>

</html>

<div
  style="width: 24px;height: 24px;fill: currentColor;color: #333;display:flex;align-items: center;justify-content: center;margin-right: 16px;">

</div>

<script>
  [...new Array(10).keys()].map(x => 1672588800 + 3600 * 24 + 3600 * 24 * 7 * (x + 1));
</script>


<script>

  function shortDateString(seconds) {
    const date = new Date(seconds * 1000);
    return `${date.getMonth() + 1}月${date.getDate()}日`;
  }
  function formatSeconds(s) {
    if (isNaN(s)) return '0:00';
    if (s < 0) s = -s;
    const time = {
      hour: Math.floor(s / 3600) % 24,
      minute: Math.floor(s / 60) % 60,
    };
    return Object.entries(time)
      .filter((val, index) => index || val[1])
      .map(val => (val[1] + '').padStart(2, '0'))
      .join(':');
  }

  function durationToSeconds(duration) {
    let result = 0;
    if (/(\d{1,2}:){1,2}\d{1,2}/.test(duration)) {
      const pieces = duration.split(':');
      for (let i = pieces.length - 1; i > -1; i--) {
        result += Math.pow(60, i) * parseInt(pieces[pieces.length - i - 1]);
      }
      return result;
    }
    result = parseInt(duration);
    if (isNaN(result)) {
      result = 0;
    }
    return result;
  }
  function timeSpan(atime, btime) {
    var milliseconds = +(btime || new Date()) - +atime;
    var seconds = ~~(milliseconds / 1000);
    var minutes = ~~(milliseconds / (1 * 60 * 1000));
    var hours = ~~(milliseconds / (1 * 60 * 60 * 1000));
    var days = ~~(milliseconds / (1 * 24 * 60 * 60 * 1000));
    var years = ~~(days / 365.5);
    return {
      years,
      days,
      hours,
      minutes,
      seconds,
      milliseconds
    };
  }

  function timeAgo(time, locales = 'zh') {
    const ts = timeSpan(time);
    if (!i18n[locales]) locales = 'zh';
    if (ts.seconds < 60) return i18n[locales].justNow;
    if (ts.minutes < 60) return ts.minutes + ' ' + i18n[locales].minutesAgo;
    if (ts.hours < 24) return ts.hours + ' ' + i18n[locales].hoursAgo;
    if (ts.days < 7) return ts.days + ' ' + i18n[locales].daysAgo;
    if (ts.days < 30) return ~~(ts.days / 7) + ' ' + i18n[locales].weeksAgo;
    if (ts.years < 1) return ~~(ts.days / 30) + ' ' + i18n[locales].monthsAgo;
    return ts.years + ' ' + i18n[locales].yearsAgo;
  }

  const i18n = {
    zh: {
      justNow: '刚刚',
      minutesAgo: '分钟前',
      hoursAgo: '小时前',
      daysAgo: '天前',
      weeksAgo: '周前',
      monthsAgo: '个月前',
      yearsAgo: '年前',
    },
    en: {
      justNow: 'just now',
      minutesAgo: 'minutes ago',
      hoursAgo: 'hours ago',
      daysAgo: 'days ago',
      weeksAgo: 'weeks ago',
      monthsAgo: 'months ago',
      yearsAgo: 'years ago',
    },
  };
</script>