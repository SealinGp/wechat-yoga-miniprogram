<navigation bind:selectedIndexChanged="onSelectedIndexChanged"></navigation>

<wxs module="dateStylish">
  module.exports = {
    style: function (id, selected) {
      if (id == selected) {
        if (id === 0) {
          return 'background: #749b15;color:#fff;border-top-left-radius:6rpx;border-bottom-left-radius:6rpx;'
        } else if (id === 6) {
          return 'background: #749b15;color:#fff;border-top-right-radius:6rpx;border-bottom-right-radius:6rpx;'
        } else {
          return 'background: #749b15;color:#fff;';
        }
      } else if (id === 6) {
        return 'background: #f3f3f3; border-top-right-radius:6rpx;border-bottom-right-radius:6rpx;'
      } else {
        return 'background:#f3f3f3;';
      }
    },
    formatDuration: function (ms) {
      var minutes = ms % 3600 / 60
      if (minutes < 10) { minutes = "0" + minutes; }
      return Math.floor(ms / 3600) + ':' + minutes;
    }
  }
</wxs>


<view class="daily-schedule">
  <view class="daily-schedule-item" style="{{dateStylish.style(item.id,selected)}}" bindtap="tapDate" data-time="{{item.time}}" wx:for="{{dates}}" wx:key="id" data-id="{{item.id}}">
    <text>{{item.week}}</text>
    <text class="daily-schedule-day">{{item.day}}</text>
    <text>{{item.month+1}}月</text>
  </view>
</view>
<view class="space"></view>
<!-- <block wx:if="{{loading}}">
  <view style="flex-grow: 1">
    <circle-loading></circle-loading>
  </view>
</block>
<block wx:else> -->
<block wx:if="{{courses.length}}">
  <view style="padding: 0 16rpx;">
    <view style="color: #202124;display: flex;background-color: #fff;margin: 0 0 20rpx 0;border-radius: 16rpx;flex-grow: 1;box-shadow: 0 0 0 2rpx #ebedef;padding-left: 32rpx;padding-right: 32rpx;" wx:for="{{courses}}" wx:key="courseId">
      <view style="display: flex;justify-content: center;margin: 32rpx 32rpx 32rpx 0 ;">
        <image style="overflow: hidden;position: relative;border-radius: 16rpx;background-color: #f8f9fa;height: 184rpx;width: 184rpx;" src="{{app.globalData.staticHost}}/images/{{item.thumbnail}}">
        </image>
      </view>
      <view style="flex-grow: 1;width: 0;position: relative;padding: 32rpx 0 80rpx;">
        <view style="font-size: 24rpx;font-weight: 400;line-height: 32rpx;overflow: hidden;text-align: left;text-overflow: ellipsis;white-space: nowrap;margin-bottom: 16rpx;display: flex;justify-content: space-between;">
          {{dateStylish.formatDuration(item.start_time)}}-{{dateStylish.formatDuration(item.end_time)}}
          <text wx:if="{{!(item.mode & 4)}}" style="color: #70757a;">{{item.teacher_name}}</text>
        </view>

        <view data-id="{{item.courseId}}" bindtap="onLesson" style="display: -webkit-box;overflow: hidden;-webkit-box-orient: vertical;white-space: normal;-webkit-line-clamp: 3;">
          {{item.lesson_name}}
        </view>
        <view style="overflow: hidden;text-overflow: ellipsis;color: #70757a;line-height: 32rpx;position: absolute;width: calc(100% - 64rpx);padding: 0 32rpx;font-size: 24rpx;left: -32rpx;bottom: 32rpx;">
          <text wx:if="{{item.mode & 4}}">{{item.teacher_name}}</text> <text wx:elif="{{!(item.mode&1)}}">已预约 {{item.count}}/{{item.peoples}}</text>
        </view>
        <view catchtap="book" wx:if="{{item.mode&8}}" data-id="{{item.course_id}}" data-time="{{item.date_time}}" style="position: absolute;padding:32rpx 32rpx 32rpx 34rpx;font-size: 30rpx;right: -32rpx;bottom: 0rpx;" class="btn">
          预约
        </view>

        <view catchtap="handleDeleteAppointment" data-reservationId="{{item.reservation_id}}" wx:if="{{item.mode&2}}" style="position: absolute;padding:32rpx 32rpx 32rpx 34rpx;font-size: 30rpx;right: -32rpx;bottom: 0rpx;color: #70757a;" class="btn">
          取消预约
        </view>
        <view wx:if="{{item.mode&16}}" style="position: absolute;padding:32rpx 32rpx 32rpx 34rpx;font-size: 30rpx;right: -32rpx;bottom: 0rpx;color: #70757a;">
          准备上课
        </view>
        <view wx:if="{{item.mode&32}}" style="position: absolute;padding:32rpx 32rpx 32rpx 34rpx;font-size: 30rpx;right: -32rpx;bottom: 0rpx;color: #70757a;">
          正在上课
        </view>
        <view wx:if="{{item.mode&128}}" style="position: absolute;padding:32rpx 32rpx 32rpx 34rpx;font-size: 30rpx;right: -32rpx;bottom: 0rpx;color: #70757a;">
          已满额
        </view>
        <view wx:if="{{item.mode&1}}" style="position: absolute;padding:32rpx 32rpx 32rpx 34rpx;font-size: 30rpx;right: -32rpx;bottom: 0rpx;color: #70757a;">
          已完成
        </view>
        <view catchtap="onSign" data-reservationId="{{item.reservation_id}}" wx:if="{{item.mode & 4}}" style="position: absolute;padding:32rpx 32rpx 32rpx 34rpx;font-size: 30rpx;right: -32rpx;top: 0rpx;" class="btn">
          签到
        </view>
      </view>

    </view>
  </view>
</block>
<block wx:else>
  <view class="empty-container">
    <image class="empty-picture" src="../../images/smile.svg"></image>
    <view class="empty-text">假日注意休息</view>
  </view>
</block>
<!-- </block> -->

<login wx:if="{{showLogin}}" host="{{app.globalData.host}}" openid="{{app.globalData.openid}}" bind:success="onSuccess"></login>



<layout active="{{active}}" titleModal="签到">
  <view style="display: flex;align-items: center;justify-content: center;flex-direction: column;height: 100%;">
    <image style="width: 300rpx;height: 300rpx;" src="{{image}}"></image>
  </view>
</layout>

<dialog bind:onPositive="onPositive" message="{{message}}" isShow="{{isShow}}" title="信息" positive="联系我们"></dialog>