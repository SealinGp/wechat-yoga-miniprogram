
```pgsql
explain analyse
with t as (select id from "user" where open_id = 'oQOVx5Dxk0E6NQO-Ojoyuky2GVR8')
select course.id                                 as course_id,
       course.peoples,
       (select count(reservation.id)
        from reservation
        where reservation.course_id = course.id) as count,
       (select reservation.id
        from reservation,
             t
        where reservation.user_id = t.id
          and reservation.course_id = course.id
        limit 1)                                 as reservation_id,
       course.start_time,
       course.end_time,
       course.date_time,
       l.name                                    as lesson_name,
       c.name                                    as teacher_name,
       c.thumbnail
from course
         join coach c on course.teacher_id = c.id
         join lesson l on l.id = course.lesson_id
where course.hidden <> 1
  and course.date_time >= 1657814400
  and course.date_time <= 1658419200
  and course.class_type & 4 = course.class_type
  and teacher_id = 6;
```

```pgsql
explain analyse
select course.id                                 as course_id,
       course.peoples,
       (select count(reservation.id)
        from reservation
        where reservation.course_id = course.id) as count,
       (select reservation.id
        from reservation
                 join "user" u  on reservation.user_id=  u.id 
        where u.open_id = 'oQOVx5Dxk0E6NQO-Ojoyuky2GVR8'
          and reservation.course_id = course.id
        limit 1)                                 as reservation_id,
       course.start_time,
       course.end_time,
       course.date_time,
       l.name                                    as lesson_name,
       c.name                                    as teacher_name,
       c.thumbnail
from course
         join coach c on course.teacher_id = c.id
         join lesson l on l.id = course.lesson_id
where course.hidden <> 1
  and course.date_time >= 1657814400
  and course.date_time <= 1658419200
  and course.class_type & 4 = course.class_type
  and teacher_id = 6;
```

```pgsql
explain analyse
select reservation.id
        from reservation
                 join "user" u  on reservation.user_id=  u.id 
        where u.open_id = 'oQOVx5Dxk0E6NQO-Ojoyuky2GVR8'
          and reservation.course_id = 1
        limit 1
```


```pgsql
explain analyse
select open_id
        from "user"
        where open_id = 'oQOVx5Dxk0E6NQO-Ojoyuky2GVR8'
        limit 1
```

```pgsql
explain analyse
select id
        from reservation
        where id = 1
        limit 1
```

```pgsql
create unique index user_open_id_key
    on "user" (open_id);
```

```pgsql
create unique index coach_id_name_thumbnail_uindex
	on coach (id,name,thumbnail);
```

```pgsql
create index reservation_course_id_index
	on reservation (course_id);
```

```pgsql
drop index user_open_id_key;
```

```pgsql
select tablename,indexname,tablespace,indexdef  from pg_indexes where tablename = 'user';
```

```
create unique index user_open_id_uindex on "user" (open_id);
```



